https://atcoder.jp/contests/arc143/tasks/arc143_b

# 問題文

N×N のマス目の各マスに 1 から N^2 までの整数を 1 つずつ書き込む方法であって，
どのマスも以下の条件のうち少なくとも一方を満たすようなものの個数を 998244353 で割ったあまりを求めてください．

- そのマスに書かれている数より大きい数が書かれているマスが同じ列に存在する．
- そのマスに書かれている数より小さい数が書かれているマスが同じ行に存在する．

1 ≦ N ≦ 500

# 案

500^2 なら 250,000 なのでマスを試しに書き込んで埋めてみることは可能。
ただ埋められる可能性は 500^2 の順列になるのでとてもじゃないが計算できない。
そのうえで書き込む数値には条件があるとはいえ無数に存在している。
探索で数を見つけるのは非常に難しそうだ。
実は違反させるほうが難しいかもしれない。

| 3 | 4 |
| 2 | 1 |

これは 3 が違反してる。なぜなら 3 は列の中で最も大きいし。行の中で最も小さい。
違反してる行列をそのままシフトしたら違反してる例がもう一個作れる

| 4 | 3 |
| 1 | 2 |

これも 3 が条件を満たしてないので違反。

| 1 | 2 |
| 4 | 3 |

これもそう。3x3 でも考えてみる。

| 7 | 8 | 9 |
| 1 | 3 | 5 |
| 2 | 4 | 6 |

こんな感じで 7 が違反してる。

| 4 | 5 | 7 |
| 3 | 1 | 8 |
| 2 | 9 | 6 |

これも 4 が違反している。
3x3 になっただけでも膨大なパターンがありそう。
一箇所違反してれば他はどう埋めても違反なのでそれはそう。

列違反ベルトの組み合わせ * 行違反ベルトの組み合わせ * ベルトの配置方法 * ベルト以外の数値の配置方法

で違反する配置方法が出せるのかな。
わからないので答えをみてみる。

# 模範解答

2つの条件を満たさないマスはたかだか１つしか作れないらしい。
条件 C を満たさないマスは下記の条件を満たす。

- 列でみたときに最大
- 行でみたときに最小

ここで、あるマス X が上の条件を満たす時
他のマス Y も列で最大かつ行で最小であると仮定する。

| X              | ? > X | ? > X && ? < Y |
| ? < X          |       | ? < Y          |
| ? < X && ? > Y | ? < Y | Y              |

このとき、

X の列であり Y の行であるマス a は
X の行であり Y の列であるマス b は

- Y < a < X
- X < b < Y

を満たさねばならない。
しかしこれは

- Y < X
- X < Y

という前提になっているため矛盾している。
したがって、条件を満たさないマスはたかだか1個しか存在しない。

- すべての配置方法は N^2 の階乗

=> N^2!

- 条件を満たさないマス X の選び方 N^2 個
- X の列、行に書かれている数の集合は2項係数を使って N^2 C 2N-1 と書ける。

なんで？
