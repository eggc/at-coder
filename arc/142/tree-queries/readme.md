https://atcoder.jp/contests/arc142/tasks/arc142_c

puts のあと $stdout.flush を使うことに注意

# 問題文
N 頂点の木があり、各頂点には 1,…,N と番号が付けられています。
また、各整数 u,v(1≤u,v≤N) に対し、頂点 u,v の距離 d(u,v) を次のように定めます。

| 頂点 u と頂点 v を結ぶ最短パスに含まれる辺の本数

あなたは次のような質問を 0 回以上 2N 回以下行うことが出来ます。

| 1≤u,v≤N かつ u+v>3 を満たす整数 u,v を指定し、頂点 u,v の距離 d(u,v) を聞く。

頂点 1,2 の距離 d(1,2) を求めてください。


# 案
## 木構造の定義

- ノードは0個以上の子を持つ
- たかだか1個の親を持つ

親子関係を置き換え可能な木構造は、任意のノードを根にすることができる
なのでノード 1 が根の場合だけを考える

## 例を観察

こんな感じの木があったときに

1 - 2 - 3 - 4
      \
        5 - 6
          \
            7

2 と 6 の最短パスは 2-5-6 でそこに含まれる辺の本数は 2 だから d(2,6) = 2
4 と 6 の最短パスは 4-3-2-5-6 でそこに含まれる辺の本数は 4 だから d(4,6) = 4

という感じ。

1 と 2 の距離は教えてもらえないので 1 と 2 以外の距離を調べて答えを知るというのが問いかけ。
そんなことできるんか？ 木構造を持っていることは確実。
問い合わせは2N回なので、すべてのノードの組み合わせを聞く (N * N-1)/2 はできない。

## 適当に聞いていく
距離1の組み合わせが見つかったら、そこは大きなヒントになりそう。
まずは (2,3), (4,5), (6,7) ... とかかな。この時点で N/2 を消費する。
図の例を考えてみると

(2,3) = 1
(4,5) = 3
(6,7) = 3

となる。2,3 の関係は確定して 4,5 や 6,7 は遠い。

4 - x1 - x2 - 5
6 - x3 - x4 - 7

みたいな関係はわかるけどそれ以上何がわかるんだろう・・・。
親か子かさえもわからない。

他の聞き方を考えよう
(1,3), (1,4), (1,5), ... ならどうだ。

(1,3) = 2
(1,4) = 3
(1,5) = 2
(1,6) = 3
(1,7) = 3

この時点で、1 と直接の親子関係にあるノードはただ一つ残っている 2 以外あり得ないので (1,2) = 1 となる。
別の木構造にしてみよう。

1 - 7 - 3 - 4
      \
        5 - 6
          \
            2

(1,3) = 2
(1,4) = 3
(1,5) = 2
(1,6) = 3
(1,7) = 1

これをみていくと、1-7 が親子関係にあるのはわかる。親子どちらなのかは不明。
2 が存在する箇所は無数にあるので、(1,2) は確定できない。
ここで

(2,7) = 2

を聞いてみる。残り問い合わせ回数14-6=8回。

1 - 7 - x - 2

7 - 1 - 2

のどちらかの構造というのがわかる。
x としてあり得るのは 3, 5 のどちらか意外にないから

(2,3) = 3
(2,5) = 1

これによって 1 - 7 - 5 - 2 の最短パスが確定した。よって (1, 2) = 3

もっと別な形も考えてみよう。

    7 - 6
  /
1 - 3
  \
    2
  \
    4
  \
    5

このような木構造を持っていた場合

(1,3) = 1
(1,4) = 1
(1,5) = 1
(1,6) = 2
(1,7) = 1

1 を根として仮想的な木作る

1 - 3
  - 4
  - 5
  - 7
  - ? - 6

2 が配置されそうな場所はまだ無数にあるが 距離 1,2,3のどれかではありそう。

(2,3) = 2
(2,4) = 2
(2,5) = 2
(2,6) = 3
(2,7) = 2

(2,6) = 3 となる 2 の居場所は 1の直接の子供以外あり得ない。
なぜなら 6 は子孫を持てないため。

## 小さな例

1 - 3 - 2

とする。

(1,3) = 1

から下の構図がわかる。

1 - 3

(2,3) = 1

が出てくるので

1 - 3 - 2

で確定する。

## より大きな例を考えてみる

1 - 3 - 6 - 10 - 14
      - 7 - 11 - 15
          - 12
  - 4 - 8 - 13 - 2
      - 9
  - 5

この例では

(1,3) = 1
(1,4) = 1
(1,5) = 1
(1,6) = 2
(1,7) = 2
(1,8) = 2
(1,9) = 2
(1,10) = 3
(1,11) = 3
(1,12) = 3
(1,13) = 3
(1,14) = 4
(1,15) = 4

こんな感じのことがわかる。この時点で 2 がとりうる距離は 1-5 のどれか。
まず 5 の可能性を探る。2 が距離 5 だとすると、14,15 の後ろにあるしかない。

(2,14) = 8
(2,15) = 8

距離 5 は否定された。
次は 4 の可能性を探る。

(2,10) = 7
(2,11) = 7
(2,12) = 7
(2,13) = 1

この時点で下記の構造のどちらか一方であることが確定。

1 - x - 2 - 13
1 - x - k - 13 - 2

k の存在を確定したい

(13,6) =
(13,7) =
(13,8) = 1
(13,9) =

となり

1 - x - 8 - 13 - 2

の構造で確定して答えは 4 となる。
もし k が見つからなかったら答えは 2 となる。

問い合わせ回数はもしかしたら上限を超えてしまうかもしれないが
一旦この作戦でやってみよう。だめだった。
中途半端に正解しててよくわからない感じになってしまったし、
いくつかは実行時間オーバーになってしまった。

# 模範解答

Di = d(1,i) + d(2,i) とする。
i = 3, ... N に対して Di を求めるのは 2N - 4 回の問い合わせで求められる。

Di の最小値が 3 より大きいなら Di の最小値が d(1,2) と一致する。
Di の最小値が 3 のときは d(1,2) = 1 の可能性がある。


1 - 4 - 3
      - 2
