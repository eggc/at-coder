* 問題よむ

- カードに名前がある 1, 2, 3, 4, ... N
- カードの表は Ai, 裏は Bi
- 最初は全部表

好きな枚数を裏返す。選んだカードを裏返した後、どの隣り合う 2 枚のカードについても、向いている面に書かれた数が相異なる。
上を満たすカードの選び方はいくつあるだろうか？ 最後に 998244353 で割った余りを計算せよ。

* 例題

i=1 1 2
i=2 4 2
i=3 3 4

に対しては

- 0枚裏返した場合
- i=1 だけ裏返した場合
- i=2 だけ裏返した場合
- i=2,3 だけ裏返した場合

  の4通りが答え

* 考察1

N = 20000 なので 2^20000 は絶対に計算できない。よって全探索はダメ。

裏返した時に起こる変化を考えてみよう。

i=1 を裏返した時に影響があるのは i=2 だけ。

i=2 を裏返した時に影響があるのは i=1, i=3 の二つ。

一般化しても同じで、影響があるのは i=i-1, i=i+1 の二つ。

カードの状態には表と裏しかない。

| i  | 1 | 2 | 3 |
|----+---+---+---|
| ai | 1 | 4 | 3 |
| bi | 2 | 2 | 4 |

なので考えれる組み合わせは事前に表で出せると思う.

| label | i          | 1      | 2      | 3 |
|-------+------------+--------+--------+---|
|     1 | i表, i+1表 | 1 4 ok | 4 3 ok |   |
|     2 | i表, i+1裏 | 1 2 ok | 4 4 ng |   |
|     3 | i裏, i+1表 | 2 4 ok | 2 3 ok |   |
|     4 | i裏, i+1裏 | 2 2 ng | 2 4 ok |   |

こんな感じ。

* 考察2

再帰的に計算できないかな

k 枚の組み合わせがわかっている時に

k+1 を裏返してもいいかどうかを調べるには

表でかぶってないなら、表の組み合わせ数
裏でかぶってないなら、裏の組み合わせ数

みたいな感じ…。たとえば k = 1 のとき

1 2

となって、

組み合わせ数=1, カードの数字=1
組み合わせ数=1, カードの数字=2

次は k = 2 のとき 4 2 がきたなら

組み合わせ数=2, カードの数字=4
組み合わせ数=1, カードの数字=2

次は k = 3 のとき 3 4 がきたなら

組み合わせ数=3, カードの数字=3
組み合わせ数=1, カードの数字=4

これはいけそうな気がしてきた。
